---
marp: true
theme: uncover
class:
 - invert
---

LIGNE DE COMMANDE: Apprendre les bases 4/6 - Gérer les paquets de son système d'exploitation
===

---

## Définitions

### Gestionnaire de paquets

Outil automatisant le processus d'installation / désinstallation / mise à jour des logiciels installés sur un OS

Vérifie la compatibilité d'un paquet avec l'OS + autres paquets déjà installés

---

### Paquets

Brique de logiciel, dont on peut établir les besoins (compatibilités et incompatibilités)

> On appelle paquet (en anglais package) une archive  comprenant les fichiers informatiques, les informations et procédures nécessaires à l'installation d'un logiciel sur un système d'exploitation [...], en s'assurant de la cohérence fonctionnelle du système - Wikipédia

---

### Dépôts

**"Source de logiciels"**
-> principalement serveur HTTP

- Transmet les mises à jour par une voie centralisée.
- Vérifie l'authenticité des paquets
- Peut fournir plusieurs versions d'un OS


Généralement, **chaque OS Linux a ses propres dépôts officiels**

```sh
# Liste des adresses des dépôts
cat /etc/apt/sources.list
```

---

## Principe de fonctionnement d'un gestionnaire de paquets
1. Contient une liste de logiciels dispos
2. Liste mise à jour afin d'assurer la cohérence de l'OS
3. Lors d'une demande d'install d'un paquet, consulte la liste et télécharge le nécessaire
4. Décompresse et place les différents fichiers binaires, de config et de doc aux endroits appropriés.
5. (Facultatif) Démarre automatiquement un service

---

### Format d'un paquet


`.rpm` : Redhat Enterprise Linux, Fedora, Centos, …
`.deb`: Debian, Ubuntu, Mint, Raspbian, …

`.exe`: Windows
`.app`: Mac (Pour installation, Image Disque `.dmg`)

---

## gestionnaire de paquets CLI et GUI

**CLI** ->
Pour Debian et ses dérivés: *APT* (Aptitude)

**GUI** ->
Pour Debian: *Synaptic*

---

## Commandes APT

*NB: à exécuter en sudo*

### Mettre à jour la liste des paquets

Avant d'installer un paquet / mise à jour de l'OS

`apt update`

### Installer un paquet

`apt install <paquet>`

---

### Voir les paquets possédant MAJ

`apt list --upgradable`


### Installer dernière version des paquets

`apt upgrade`


---

### Forcer l'installation de paquets cassés
Paquet considéré comme cassé s'il nécessite une intervention manuelle pour gérer dépendances (obsolètes, pas à jour, etc...)

`apt install -f`

### Rechercher un paquet
`apt search <paquet>`

---

### Désinstaller un paquet

```sh
# Supprime le paquet
apt remove <paquet>

# Supprime le paquet + ses fichiers de configuration,
# de préférences et les logs
apt purge <paquet>
```

### Forcer quand paquet cassé

```sh
# -f: --fix-broken
apt purge -f mon_paquet
```

---


## Utilitaire dpkg

Librairie de bas niveau
Ne gère pas les dépendances

Permet de gérer des `.deb``

```sh
# Installer un paquet en local
sudo dpkg -i <paquet.deb>

# Chercher un paquet
dpkg -l *office*
```

---

## Les sources de dépôt (Debian)

**main**: officiellement pris en charge
**contrib**: Logiciel libre, mais dont les dépendances ne le sont pas
**non-free**: Logiciel non libre

```sh
# apt edit-sources
deb http://deb.debian.org/debian bullseye main contrib non-free
deb-src http://deb.debian.org/debian bullseye main contrib non-free
```

*NB: Libre selon les principes du projet Debian*

---

## SNAP

Permet aux développeurs de publier leurs applications directement auprès des utilisateurs.

- Pas de délai d'attente, comme dans les sources officiels
- Chaque app peut être isolée, ce qui augmente la stabilité et sécurité de l'OS

---

https://snapcraft.io/

`--classic`: Sans cette option, l'app est strictement confinée.
Ne peut pas accéder aux fichiers, réseau, et process sans avoir demandé les droits spécifiques auparavant.

```sh
# Installer snap
sudo apt install snapd

# Installer Spotify grâce à snap
sudo snap install spotify

# Installer pour exécuter en non isolé
sudo snap install --classic slack
```

---


## Aller plus loin: Auto MAJ

Mise à jour manuelle conseillée.
Mais intéressant pour serveur web

Sur Linux, grâce à ``unattended-upgrades``:
https://wiki.debian.org/UnattendedUpgrades


---

## Sur Windows: Chocolatey

https://chocolatey.org/


Liste des paquets disponibles [ici](https://community.chocolatey.org/packages)


```sh
## Installer MalwareBytes
choco install malwarebytes

# Mettre à jour Chocolatey ou tout
choco upgrade chocolatey
choco upgrade all

choco uninstall notepadplusplus
```

---


## Sur Mac: Homebrew

https://brew.sh/


```sh
# Installer mysql
brew install mysql

# --cask pour Appli GUI
brew install --cask blender

# Mettre à jour les définitions de paquets
brew update

# Mettre à jour les paquets
brew upgrade
```
