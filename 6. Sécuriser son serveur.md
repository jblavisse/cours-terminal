---
marp: true
theme: uncover
class:
 - invert
---


LIGNE DE COMMANDE: Apprendre les bases 6/6 - Sécuriser son serveur
===

---

## 1. Sécuriser l'utilisateur par défaut

Comment?
**En changeant son mot de passe**

```sh
passwd
```

NB: Encore plus important si cet utilisateur était `root`!

---

## 2. Créer notre propre utilisateur

```sh
# Créer l'utilisateur jb
sudo adduser jb

# L'ajouter au groupe sudo
sudo adduser jb sudo

# Se connecter avec jb
su - jb
```

---


## 3. Se connecter en SSH

```sh
# Créer le dossier contenant nos clés SSH
mkdir ~/.ssh

# Donner les pleins droits qu'à notre utilisateur
chmod 700 ~/.ssh

# Créer un fichier pour les clés autorisées
nano ~/.ssh/authorized_keys

# Lui donner les droits en lecture
chmod 400 ~/.ssh/authorized_keys
```

Dans `authorized_keys`, coller le contenu de la clé SSH publique de notre ordinateur local.

---

### Générer une clé SSH en local

Voir [doc Github](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)

```sh
ssh-keygen -t ed25519 -C "monadresse@email.com"
```

Créera :
- Une clé privée (`id_ed25519`)
- Une clé publique (`id_ed25519.pub`)

---

### Activer la connexion par SSH

```sh
# nano /etc/ssh/sshd_config
PasswordAuthentication no
```

Puis redémarrer le service SSH
```sh
sudo service ssh restart
```


---

## 4. Mettre à jour son système

```sh
sudo apt update
sudo apt upgrade
```

---


### Activer les mises à jour automatiques

Installe périodiquement les mises à jour de sécurité, sans l'action de l'administrateur

```sh
sudo apt install unattended-upgrades
```

NB: Les lgos sont dispos dans `/var/log/unattended-upgrades` ou `var/log/dpkg.log` ([doc Debian](https://wiki.debian.org/fr/unattended-upgrades))

---

## 5. Installer un pare-feu

**ufw**: Uncomplicated Firewall
Applique des règles définies

```sh
# installer ufw
sudo apt install ufw

# Connaître le statut actuel (par défaut, désactivé)
sudo ufw status

# Activer ufw
sudo ufw enable

# Désactiver ufw
sudo ufw disable
```

---

### Bases pour un serveur web

```sh
# Autoriser le tarif SSH (port 22)
sudo ufw allow ssh

# Autoriser le port 80 et 443 (http et https)
sudo ufw allow 80
sudo ufw allow 443

# Activer ufw
sudo ufw enable

# Afficher les règles actuelles
sudo ufw status verbose
```

---

## 6. Prévenir des intrusions

**Fail2ban**: pour bannir des IP

Analyse les logs des services.
Sert à bloquer des tentatives répétées de connexions infructueuses en repérant l'IP.

```sh
sudo apt install fail2ban
```

---

### Paramétrage de Fail2ban

Par défaut, fait le job

```sh
# sudo nano /etc/fail2ban/jail.conf

# IP bannie pendant 10 min
bantime = 10m

# Nombre de tentatives avant d'être ban
maxretry = 5

# Si tentatives avant ces X min, ban
findTime  = 10m
```
---

## 7. Sécuriser le SGBD(R)

**Pour MariaDB/MySQL: mysql_secure_installation**

- Initie un mot de passe pour l'utilisateur root
- Spprime les comptes anonymes
- Supprime la BDD de test, accessibles par défaut pour les comptes anonymes

```sh
mysql_secure_installation
```